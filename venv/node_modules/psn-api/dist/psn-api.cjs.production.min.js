"use strict";function r(r){return r&&"object"==typeof r&&"default"in r?r:{default:r}}Object.defineProperty(exports,"__esModule",{value:!0});var e=r(require("isomorphic-unfetch"));function t(){t=function(){return r};var r={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(r,e,t){return Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{c({},"")}catch(r){c=function(r,e,t){return r[e]=t}}function s(r,e,t,n){var o=Object.create((e&&e.prototype instanceof h?e:h).prototype),a=new _(n||[]);return o._invoke=function(r,e,t){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(t.method=o,t.arg=a;;){var i=t.delegate;if(i){var u=k(i,t);if(u){if(u===l)continue;return u}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===n)throw n="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);n="executing";var c=p(r,e,t);if("normal"===c.type){if(n=t.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:t.done}}"throw"===c.type&&(n="completed",t.method="throw",t.arg=c.arg)}}}(r,t,a),o}function p(r,e,t){try{return{type:"normal",arg:r.call(e,t)}}catch(r){return{type:"throw",arg:r}}}r.wrap=s;var l={};function h(){}function f(){}function d(){}var v={};c(v,a,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(I([])));m&&m!==e&&n.call(m,a)&&(v=m);var g=d.prototype=h.prototype=Object.create(v);function w(r){["next","throw","return"].forEach((function(e){c(r,e,(function(r){return this._invoke(e,r)}))}))}function x(r,e){function t(o,a,i,u){var c=p(r[o],r,a);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(r){t("next",r,i,u)}),(function(r){t("throw",r,i,u)})):e.resolve(l).then((function(r){s.value=r,i(s)}),(function(r){return t("throw",r,i,u)}))}u(c.arg)}var o;this._invoke=function(r,n){function a(){return new e((function(e,o){t(r,n,e,o)}))}return o=o?o.then(a,a):a()}}function k(r,e){var t=r.iterator[e.method];if(void 0===t){if(e.delegate=null,"throw"===e.method){if(r.iterator.return&&(e.method="return",e.arg=void 0,k(r,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=p(t,r.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var o=n.arg;return o?o.done?(e[r.resultName]=o.value,e.next=r.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function b(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function T(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function _(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(b,this),this.reset(!0)}function I(r){if(r){var e=r[a];if(e)return e.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var t=-1,o=function e(){for(;++t<r.length;)if(n.call(r,t))return e.value=r[t],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return f.prototype=d,c(g,"constructor",d),c(d,"constructor",f),f.displayName=c(d,u,"GeneratorFunction"),r.isGeneratorFunction=function(r){var e="function"==typeof r&&r.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,d):(r.__proto__=d,c(r,u,"GeneratorFunction")),r.prototype=Object.create(g),r},r.awrap=function(r){return{__await:r}},w(x.prototype),c(x.prototype,i,(function(){return this})),r.AsyncIterator=x,r.async=function(e,t,n,o,a){void 0===a&&(a=Promise);var i=new x(s(e,t,n,o),a);return r.isGeneratorFunction(t)?i:i.next().then((function(r){return r.done?r.value:i.next()}))},w(g),c(g,u,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),r.keys=function(r){var e=[];for(var t in r)e.push(t);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=I,_.prototype={constructor:_,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!r)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var r=this.tryEntries[0].completion;if("throw"===r.type)throw r.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function t(t,n){return i.type="throw",i.arg=r,e.next=t,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return t("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return t(a.catchLoc,!0);if(this.prev<a.finallyLoc)return t(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return t(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return t(a.finallyLoc)}}}},abrupt:function(r,e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===r||"continue"===r)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=r,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(i)},complete:function(r,e){if("throw"===r.type)throw r.arg;return"break"===r.type||"continue"===r.type?this.next=r.arg:"return"===r.type?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):"normal"===r.type&&e&&(this.next=e),l},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===r)return this.complete(t.completion,t.afterLoc),T(t),l}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===r){var n=t.completion;if("throw"===n.type){var o=n.arg;T(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,t){return this.delegate={iterator:I(r),resultName:e,nextLoc:t},"next"===this.method&&(this.arg=void 0),l}},r}function n(r,e,t,n,o,a,i){try{var u=r[a](i),c=u.value}catch(r){return void t(r)}u.done?e(c):Promise.resolve(c).then(n,o)}function o(r){return function(){var e=this,t=arguments;return new Promise((function(o,a){var i=r.apply(e,t);function u(r){n(i,o,a,u,c,"next",r)}function c(r){n(i,o,a,u,c,"throw",r)}u(void 0)}))}}function a(){return a=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},a.apply(this,arguments)}var i,u=function(){var r=o(t().mark((function r(n){var o,a;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,e.default("https://ca.account.sony.com/api/authz/v3/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic MDk1MTUxNTktNzIzNy00MzcwLTliNDAtMzgwNmU2N2MwODkxOnVjUGprYTV0bnRCMktxc1A="},body:new URLSearchParams({code:n,redirect_uri:"com.scee.psxandroid.scecompcall://redirect",grant_type:"authorization_code",token_format:"jwt"}).toString()});case 3:return o=r.sent,r.next=6,o.json();case 6:return r.abrupt("return",{accessToken:(a=r.sent).access_token,expiresIn:a.expires_in,idToken:a.id_token,refreshToken:a.refresh_token,refreshTokenExpiresIn:a.refresh_token_expires_in,scope:a.scope,tokenType:a.token_type});case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),c=function(){var r=o(t().mark((function r(n){var o,a,i,u,c,s;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=new URLSearchParams({access_type:"offline",client_id:"09515159-7237-4370-9b40-3806e67c0891",redirect_uri:"com.scee.psxandroid.scecompcall://redirect",response_type:"code",scope:"psn:mobile.v2.core psn:clientapp"}).toString(),i="https://ca.account.sony.com/api/authz/v3/oauth/authorize?"+a,r.next=4,e.default(i,{headers:{Cookie:"npsso="+n},redirect:"manual"});case 4:if((u=r.sent.headers).has("location")&&null!=(o=u.get("location"))&&o.includes("?code=")){r.next=8;break}throw new Error("\n      There was a problem retrieving your PSN access code. Is your NPSSO code valid?\n      To get a new NPSSO code, visit https://ca.account.sony.com/api/v1/ssocookie.\n    ");case 8:return c=u.get("location"),s=new URLSearchParams(c.split("redirect/")[1]),r.abrupt("return",s.get("code"));case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),s=function(){var r=o(t().mark((function r(n){var o,a;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,e.default("https://ca.account.sony.com/api/authz/v3/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic MDk1MTUxNTktNzIzNy00MzcwLTliNDAtMzgwNmU2N2MwODkxOnVjUGprYTV0bnRCMktxc1A="},body:new URLSearchParams({refresh_token:n,grant_type:"refresh_token",token_format:"jwt",scope:"psn:mobile.v2.core psn:clientapp"}).toString()});case 3:return o=r.sent,r.next=6,o.json();case 6:return r.abrupt("return",{accessToken:(a=r.sent).access_token,expiresIn:a.expires_in,idToken:a.id_token,refreshToken:a.refresh_token,refreshTokenExpiresIn:a.refresh_token_expires_in,scope:a.scope,tokenType:a.token_type});case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();exports.TrophyRarity=void 0,(i=exports.TrophyRarity||(exports.TrophyRarity={}))[i.UltraRare=0]="UltraRare",i[i.VeryRare=1]="VeryRare",i[i.Rare=2]="Rare",i[i.Common=3]="Common";var p=["headerOverrides"],l=function(r,e,t,n){void 0===t&&(t={}),void 0===n&&(n={});for(var o=function(r,e){if(null==r)return{};var t,n,o={},a=Object.keys(r);for(n=0;n<a.length;n++)e.indexOf(t=a[n])>=0||(o[t]=r[t]);return o}(t,p),i=(r+"/"+e).replace(/([^:]\/)\/+/g,"$1"),u={},c=0,s=Object.entries(a({},n,o));c<s.length;c++){var l=s[c],h=l[0],f=l[1];i.includes(":"+h)?i=i.replace(":"+h,String(f)):void 0!==f&&(u[h]=String(f))}var d=new URLSearchParams(u).toString();return d.length>0?i+"?"+d:i},h=function(){var r=o(t().mark((function r(n,o,i){var u,c;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.default(n.url,{method:null!=(u=null==n?void 0:n.method)?u:"GET",headers:a({Authorization:"Bearer "+o.accessToken,"Content-Type":"application/json"},null==n?void 0:n.headers),body:JSON.stringify(i)});case 2:return c=r.sent,r.next=5,c.json();case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}(),f=function(){var r=o(t().mark((function r(e,n,o){var a;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=l("https://m.np.playstation.com/api/search","/v1/universalSearch"),r.next=3,h({url:a,method:"POST"},e,{searchTerm:n,domainRequests:[{domain:o}]});case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}(),d="https://m.np.playstation.com/api/trophy",v=function(){var r=o(t().mark((function r(e,n,o,a){var i;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=l(d,"/v1/npCommunicationIds/:npCommunicationId/trophyGroups/:trophyGroupId/trophies",a,{npCommunicationId:n,trophyGroupId:o}),r.next=3,h({url:i,headers:null==a?void 0:a.headerOverrides},e);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})));return function(e,t,n,o){return r.apply(this,arguments)}}(),y=function(){var r=o(t().mark((function r(e,n,o){var a;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=l(d,"/v1/npCommunicationIds/:npCommunicationId/trophyGroups",o,{npCommunicationId:n}),r.next=3,h({url:a,headers:null==o?void 0:o.headerOverrides},e);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}(),m=function(){var r=o(t().mark((function r(e,n,o){var a;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=l(d,"/v1/users/:accountId/trophyTitles",o,{accountId:n}),r.next=3,h({url:a,headers:null==o?void 0:o.headerOverrides},e);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}(),g=function(){var r=o(t().mark((function r(e,n,o,a,i){var u,c,s,p;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return u=l(d,"/v1/users/:accountId/npCommunicationIds/:npCommunicationId/trophyGroups/:trophyGroupId/trophies",i,{accountId:n,npCommunicationId:o,trophyGroupId:a}),r.next=3,h({url:u,headers:null==i?void 0:i.headerOverrides},e);case 3:if(null==(c=r.sent)||!c.error){r.next=6;break}throw new Error(null!=(s=null==c||null==(p=c.error)?void 0:p.message)?s:"Unexpected Error");case 6:return r.abrupt("return",c);case 7:case"end":return r.stop()}}),r)})));return function(e,t,n,o,a){return r.apply(this,arguments)}}(),w=function(){var r=o(t().mark((function r(e,n,o,a){var i,u,c,s;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=l(d,"/v1/users/:accountId/npCommunicationIds/:npCommunicationId/trophyGroups",a,{accountId:n,npCommunicationId:o}),r.next=3,h({url:i,headers:null==a?void 0:a.headerOverrides},e);case 3:if(null==(u=r.sent)||!u.error){r.next=6;break}throw new Error(null!=(c=null==u||null==(s=u.error)?void 0:s.message)?c:"Unexpected Error");case 6:return r.abrupt("return",u);case 7:case"end":return r.stop()}}),r)})));return function(e,t,n,o){return r.apply(this,arguments)}}(),x=function(){var r=o(t().mark((function r(e,n,o){var a;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=l(d,"/v1/users/:accountId/trophySummary",o,{accountId:n}),r.next=3,h({url:a,headers:null==o?void 0:o.headerOverrides},e);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}(),k="https://m.np.playstation.com/api/userProfile/v1/internal/users",b=function(){var r=o(t().mark((function r(e,n,o){var a,i,u,c;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=l(k,"/:accountId/profiles",o,{accountId:n}),r.next=3,h({url:a},e);case 3:if(null==(i=r.sent)||!i.error){r.next=6;break}throw new Error(null!=(u=null==i||null==(c=i.error)?void 0:c.message)?u:"Unexpected Error");case 6:return r.abrupt("return",i);case 7:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}(),T=function(){var r=o(t().mark((function r(e,n){var o,a,i,u;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o="https://us-prof.np.community.playstation.net/userProfile/v1/users/"+n+"/profile2?fields=npId,onlineId,accountId,avatarUrls,plus,aboutMe,languagesUsed,trophySummary(@default,level,progress,earnedTrophies),isOfficiallyVerified,personalDetail(@default,profilePictureUrls),personalDetailSharing,personalDetailSharingRequestMessageFlag,primaryOnlineStatus,presences(@default,@titleInfo,platform,lastOnlineDate,hasBroadcastData),requestMessageFlag,blocking,friendRelation,following,consoleAvailability",r.next=3,h({url:o},e);case 3:if(null==(a=r.sent)||!a.error){r.next=6;break}throw new Error(null!=(i=null==a||null==(u=a.error)?void 0:u.message)?i:"Unexpected Error");case 6:return r.abrupt("return",a);case 7:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}(),_=function(){var r=o(t().mark((function r(e,n,o){var a,i,u,c;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=l(k,"/:accountId/friends",o,{accountId:n}),r.next=3,h({url:a},e);case 3:if(null==(i=r.sent)||!i.error){r.next=6;break}throw new Error(null!=(u=null==i||null==(c=i.error)?void 0:c.message)?u:"Unexpected Error");case 6:return r.abrupt("return",i);case 7:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}();exports.call=h,exports.exchangeCodeForAccessToken=u,exports.exchangeNpssoForCode=c,exports.exchangeRefreshTokenForAuthTokens=s,exports.getProfileFromAccountId=b,exports.getProfileFromUserName=T,exports.getTitleTrophies=v,exports.getTitleTrophyGroups=y,exports.getUserFriendsAccountIds=_,exports.getUserTitles=m,exports.getUserTrophiesEarnedForTitle=g,exports.getUserTrophyGroupEarningsForTitle=w,exports.getUserTrophyProfileSummary=x,exports.makeUniversalSearch=f;
//# sourceMappingURL=psn-api.cjs.production.min.js.map
